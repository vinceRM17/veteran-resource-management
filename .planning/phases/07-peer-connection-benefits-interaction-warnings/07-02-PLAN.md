---
phase: 07-peer-connection-benefits-interaction-warnings
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/components/peer-connection/peer-connection-card.tsx
  - src/components/peer-connection/peer-search-form.tsx
  - src/app/peer-connection/support-groups/page.tsx
  - src/app/peer-connection/events/page.tsx
  - src/app/peer-connection/opportunities/page.tsx
  - src/components/layout/header.tsx
autonomous: true

must_haves:
  truths:
    - "User can search for verified support groups by city or ZIP code at /peer-connection/support-groups"
    - "User can search for events and activities by location at /peer-connection/events"
    - "User can discover opportunities from verified organizations at /peer-connection/opportunities"
    - "Every listing shows verification badge (VA Accredited, Verified Nonprofit, or Registered Organization) with source"
    - "User can navigate to Peer Connections from the main site header"
    - "Search filters persist in URL via nuqs (bookmarkable)"
  artifacts:
    - path: "src/components/peer-connection/peer-connection-card.tsx"
      provides: "Card component for peer connection listings with verification badge"
      exports: ["PeerConnectionCard"]
    - path: "src/components/peer-connection/peer-search-form.tsx"
      provides: "Search form with location, branch, and era filters using nuqs"
      exports: ["PeerSearchForm"]
    - path: "src/app/peer-connection/support-groups/page.tsx"
      provides: "Support groups search page with results"
      min_lines: 50
    - path: "src/app/peer-connection/events/page.tsx"
      provides: "Events search page with results"
      min_lines: 50
    - path: "src/app/peer-connection/opportunities/page.tsx"
      provides: "Opportunities search page with results"
      min_lines: 50
  key_links:
    - from: "src/app/peer-connection/support-groups/page.tsx"
      to: "src/lib/db/peer-queries.ts"
      via: "searchPeerConnections({ type: 'support-groups' })"
      pattern: "searchPeerConnections"
    - from: "src/components/peer-connection/peer-connection-card.tsx"
      to: "src/lib/db/peer-types.ts"
      via: "getVerificationSource(org)"
      pattern: "getVerificationSource"
    - from: "src/components/peer-connection/peer-search-form.tsx"
      to: "nuqs"
      via: "useQueryState for location, branch, era filters"
      pattern: "useQueryState"
    - from: "src/components/layout/header.tsx"
      to: "/peer-connection"
      via: "Navigation link"
      pattern: "peer-connection"
---

<objective>
Build the three peer connection search pages (support groups, events, opportunities) with verification badges and location/branch/era filters. Add navigation link to the site header.

Purpose: Veterans can discover verified organizations near them, with clear verification source on every listing.
Output: Three search pages, reusable card and search form components, updated header navigation.
</objective>

<execution_context>
@/Users/vincecain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vincecain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Plan 01 provides the data layer
@.planning/phases/07-peer-connection-benefits-interaction-warnings/07-01-SUMMARY.md

# Existing directory components as pattern reference
@src/components/directory/org-card.tsx
@src/components/directory/search-form.tsx
@src/app/directory/page.tsx
@src/lib/db/peer-types.ts
@src/lib/db/peer-queries.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: PeerConnectionCard and PeerSearchForm components</name>
  <files>
    src/components/peer-connection/peer-connection-card.tsx
    src/components/peer-connection/peer-search-form.tsx
  </files>
  <action>
    Create `src/components/peer-connection/peer-connection-card.tsx`:
    1. Import PeerConnectionSearchResult and getVerificationSource from peer-types.ts
    2. Accept props: { org: PeerConnectionSearchResult }
    3. Display: org_name as CardTitle linking to /directory/{org.id} (reuse existing detail page), city/state/zip as CardDescription
    4. Verification badge section:
       - Call getVerificationSource(org) to get { label, source, tier }
       - Render Badge with variant based on tier: primary = "default" (blue), secondary = "secondary", tertiary = "outline"
       - Include appropriate lucide-react icon: ShieldCheck for VA Accredited, Shield for Verified Nonprofit, Building2 for others
       - Below the badge, render small text: "Verified: {source}" in text-xs text-muted-foreground
    5. Services section: org.services_offered truncated with line-clamp-2
    6. NTEE description: small Badge showing ntee_description if available
    7. Contact info row: phone (tel: link), email (mailto: link), website (external link) — same pattern as OrgCard
    8. Use Card/CardHeader/CardContent/CardTitle/CardDescription from shadcn/ui
    9. Add hover:shadow-lg transition-shadow on Card (matches OrgCard pattern)

    Create `src/components/peer-connection/peer-search-form.tsx` as 'use client' component:
    1. Import useQueryState from 'nuqs', useDebouncedCallback from 'use-debounce'
    2. URL state parameters via nuqs (matching SearchForm pattern from directory):
       - `location` (string) — city name or ZIP code
       - `branch` (string) — military branch filter
       - `era` (string) — service era filter
       - `page` (string, default '1')
    3. Location input: text field with placeholder "City name or ZIP code", 300ms debounce (matching existing pattern)
    4. Branch filter: Select dropdown with options: "All branches", "Army", "Navy", "Air Force", "Marine Corps", "Coast Guard", "Space Force"
    5. Era filter: Select dropdown with options: "All eras", "Post-9/11", "Gulf War", "Vietnam", "Korea", "WWII", "Peacetime"
    6. Clear filters button (appears when any filter active)
    7. All filter changes reset page to '1'
    8. Use Label, Input, Button, Select/SelectContent/SelectItem/SelectTrigger/SelectValue from shadcn/ui
    9. Layout: location input full-width, branch and era side-by-side in grid-cols-1 md:grid-cols-2
    10. Wrap in bg-white rounded-lg border p-6 space-y-6 (matches SearchForm)
    11. Props: none (all state in URL via nuqs)
    12. Add Zod validation on location: min 2 chars, accepts city names (letters/spaces/hyphens) or ZIP codes (5 digits or ZIP+4). Show inline error message below input if invalid.
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - PeerConnectionCard renders verification badge based on org verification tier
    - PeerSearchForm manages URL state via nuqs with debounced location input
  </verify>
  <done>
    PeerConnectionCard shows verification badge with source. PeerSearchForm provides location/branch/era filters persisted in URL. Both components follow existing directory component patterns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Three search pages + header navigation update</name>
  <files>
    src/app/peer-connection/support-groups/page.tsx
    src/app/peer-connection/events/page.tsx
    src/app/peer-connection/opportunities/page.tsx
    src/components/layout/header.tsx
  </files>
  <action>
    Create three search pages following the EXACT same pattern as src/app/directory/page.tsx:

    For each page (`support-groups/page.tsx`, `events/page.tsx`, `opportunities/page.tsx`):
    1. Server Component that accepts searchParams prop (Promise-based like DirectoryPage)
    2. Parse URL params: location, branch, era, page
    3. Call searchPeerConnections({ type: '{type}', location, branch, era, page }) from peer-queries.ts
    4. Render:
       - H1 with title from PEER_CONNECTION_LABELS (e.g., "Support Groups")
       - Subtitle describing the section
       - PeerSearchForm component (client component for filters)
       - Suspense boundary wrapping results
       - Results count: "Found {N} {type}" or "No {type} found"
       - Grid of PeerConnectionCard components (grid gap-6 single column)
       - PaginationControls (reuse from src/components/directory/pagination-controls.tsx)
       - Empty state with suggestions to broaden search
    5. Each page is a Server Component — data fetched server-side for SEO
    6. Add metadata export with appropriate title and description for each page
    7. Back link: "← Back to Peer Connections" linking to /peer-connection

    **Differences per page:**
    - support-groups: H1 "Support Groups & Veteran Communities", description "Find verified support groups, veteran service organizations, and community resources near you."
    - events: H1 "Events & Activities", description "Discover veteran events, community activities, and cultural programs from verified organizations."
    - opportunities: H1 "Opportunities", description "Find employment programs, volunteer roles, and vocational training from verified veteran organizations."

    Update `src/components/layout/header.tsx`:
    1. Read the existing header file first to understand the current navigation structure
    2. Add "Peer Connections" nav link between "Tools" and the auth section (if pattern uses array of nav items, add to array; if inline links, add after Tools link)
    3. Link to /peer-connection
    4. Follow existing nav link pattern exactly (same className, same responsive behavior)
  </action>
  <verify>
    - `npm run build` passes
    - /peer-connection/support-groups renders search form and results
    - /peer-connection/events renders search form and results
    - /peer-connection/opportunities renders search form and results
    - Header shows "Peer Connections" navigation link
    - URL state persists across page navigation (location, branch, era in URL)
  </verify>
  <done>
    Three search pages render verified peer connection listings filtered by location and branch/era. Header navigation includes Peer Connections link. All pages follow existing directory page patterns with Suspense boundaries and server-side data fetching.
  </done>
</task>

</tasks>

<verification>
- All three search pages accessible and rendering
- Verification badges visible on every listing card
- Location filter works with city names and ZIP codes
- Branch and era filter dropdowns functional
- Pagination works correctly
- Header navigation updated
- URL state persists (bookmarkable search URLs)
- Empty state renders when no results found
</verification>

<success_criteria>
1. `npm run build` passes with no errors
2. /peer-connection/support-groups shows support group listings with verification badges
3. /peer-connection/events shows event listings with verification badges
4. /peer-connection/opportunities shows opportunity listings with verification badges
5. All listings show verification source (VA Accredited, Verified Nonprofit, or Registered Organization)
6. Search by city or ZIP code filters results correctly
7. "Peer Connections" link visible in site header navigation
</success_criteria>

<output>
After completion, create `.planning/phases/07-peer-connection-benefits-interaction-warnings/07-02-SUMMARY.md`
</output>
