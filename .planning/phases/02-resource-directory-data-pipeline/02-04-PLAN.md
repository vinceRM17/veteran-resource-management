---
phase: 02-resource-directory-data-pipeline
plan: 04
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - src/app/directory/businesses/page.tsx
  - src/app/directory/businesses/[id]/page.tsx
  - src/components/directory/business-card.tsx
  - src/content/documentation-checklists.ts
  - src/app/resources/documents/page.tsx
  - src/components/layout/Header.tsx
autonomous: false

must_haves:
  truths:
    - "User can search 5,500+ veteran-owned businesses by name, industry, and location"
    - "User can filter businesses by state and business type"
    - "User can view business detail page with contact info and industry classification"
    - "User can access documentation checklists showing required documents per benefit program"
    - "Directory navigation is accessible from the main site header"
  artifacts:
    - path: "src/app/directory/businesses/page.tsx"
      provides: "Business search page with filters and results"
    - path: "src/app/directory/businesses/[id]/page.tsx"
      provides: "Business detail page"
    - path: "src/components/directory/business-card.tsx"
      provides: "Business result card component"
      exports: ["BusinessCard"]
    - path: "src/content/documentation-checklists.ts"
      provides: "Static content for program documentation requirements"
      exports: ["documentationChecklists", "DocumentationChecklist"]
    - path: "src/app/resources/documents/page.tsx"
      provides: "Documentation checklists page"
  key_links:
    - from: "src/app/directory/businesses/page.tsx"
      to: "src/lib/db/queries.ts"
      via: "Server Component fetching business search results"
      pattern: "searchBusinesses"
    - from: "src/components/layout/Header.tsx"
      to: "src/app/directory/page.tsx"
      via: "Navigation link to directory"
      pattern: "href.*directory"
---

<objective>
Build the veteran-owned business search interface and documentation checklists page, completing the user-facing features of Phase 2. Update site navigation to include directory links.

Purpose: Business search (DIR-04) lets veterans find veteran-owned businesses for services. Documentation checklists (DIR-06) help veterans prepare required documents before applying to programs. Site navigation update ensures discoverability.

Output: Business search page with filters, business detail page, documentation checklists content page, and updated header navigation.
</objective>

<execution_context>
@/Users/vincecain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vincecain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-resource-directory-data-pipeline/02-RESEARCH.md
@.planning/phases/02-resource-directory-data-pipeline/02-01-SUMMARY.md
@.planning/phases/02-resource-directory-data-pipeline/02-03-SUMMARY.md
@src/lib/db/queries.ts
@src/lib/db/types.ts
@src/components/directory/search-form.tsx
@src/components/directory/verification-badge.tsx
@src/components/layout/Header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build business search and detail pages with documentation checklists</name>
  <files>
    src/app/directory/businesses/page.tsx
    src/app/directory/businesses/[id]/page.tsx
    src/components/directory/business-card.tsx
    src/content/documentation-checklists.ts
    src/app/resources/documents/page.tsx
    src/components/layout/Header.tsx
  </files>
  <action>
**Business card (`src/components/directory/business-card.tsx`):**

Similar to OrgCard but for businesses:
- legal_business_name as heading (link to `/directory/businesses/[id]`)
- dba_name if different from legal name ("DBA: [name]")
- city, state, zip on one line
- business_type badge (e.g. "Veteran Owned Small Business" or "Service Disabled Veteran Owned")
- naics_descriptions (industry description, truncated to 2 lines)
- owner_name and service_branch if available
- Contact links: phone, email, website
- VerificationBadge for last_verified_date
- Uses shadcn Card component

**Business search page (`src/app/directory/businesses/page.tsx`):**

Server Component following the same pattern as the organization search page:
1. Reads searchParams from page props
2. Calls `searchBusinesses()` from queries.ts with params
3. Uses a simplified version of SearchForm (reuse search-form.tsx or create a thin wrapper) with:
   - Search input (debounced, FTS on business name + industry)
   - State filter dropdown
   - Business type filter dropdown (values: "Veteran Owned Small Business", "Service Disabled Veteran Owned Small Business")
   - Uses nuqs for URL state: `q`, `state`, `type`, `page`
4. Renders list of BusinessCard components
5. PaginationControls at bottom (reuse from Plan 03)
6. "No businesses found" message when empty
7. Show result count: "Found X veteran-owned businesses"

Create a `getDistinctBusinessTypes()` function in queries.ts that fetches unique business_type values from the businesses table.

**Business detail page (`src/app/directory/businesses/[id]/page.tsx`):**

Server Component:
1. Reads `id` from route params
2. Calls `getBusinessById(id)` from queries.ts (add this function: `supabase.from('businesses').select('*').eq('id', id).single()`)
3. If not found, return `notFound()`
4. Renders business information:
   - **Header:** legal_business_name (h1), dba_name, business_type badge
   - **Contact card:** Address, phone (tel:), email (mailto:), website (external link)
   - **Business details:** NAICS codes + descriptions (industry classification), owner_name, service_branch
   - **Registration info:** registration_status, registration_expiration, UEI, CAGE code
   - **Freshness:** VerificationBadge, source
   - **Back link:** "Back to business directory"
5. Generate metadata (title, description)

**Documentation checklists (`src/content/documentation-checklists.ts`):**

Static TypeScript content file with program documentation requirements. Each checklist:

```typescript
export interface DocumentationChecklist {
  programId: string;
  programName: string;
  description: string;
  documents: {
    name: string;
    description: string;
    required: boolean; // true = required, false = recommended
    howToObtain: string; // Brief instruction on where to get this document
  }[];
  tips: string[]; // General tips for the application
}
```

Include checklists for these core programs (Kentucky-focused, matching Phase 3 screening):
1. **VA Disability Compensation** - DD-214, medical records, VA Form 21-526EZ, buddy statements
2. **VA Healthcare (VA Medical Benefits)** - DD-214, VA Form 10-10EZ, insurance info
3. **Medicaid (Kentucky)** - Proof of income, ID, residency proof, Social Security card
4. **SNAP (Food Stamps, Kentucky)** - Proof of income, ID, residency, Social Security, bank statements
5. **SSI (Supplemental Security Income)** - Medical records, work history, birth certificate, Social Security card
6. **SSDI (Social Security Disability)** - Work history, medical records, DD-214 (if service-connected), tax returns
7. **Kentucky HCB Waiver** - Level of care assessment, Medicaid eligibility, physician documentation
8. **Veterans Pension** - DD-214, VA Form 21P-527EZ, income documentation, net worth statement

Export as `documentationChecklists: DocumentationChecklist[]`.

**Documentation checklists page (`src/app/resources/documents/page.tsx`):**

Server Component that:
- Renders page title "Documentation Checklists"
- Brief intro: "Gather these documents before applying to speed up your application process."
- Lists each program as an expandable section (use shadcn Accordion or Collapsible):
  - Program name as heading
  - Description
  - Required documents with checkboxes (visual only, not functional -- functional tracking in Phase 5)
  - Recommended documents in separate section
  - "How to obtain" text for each document
  - Tips section at bottom of each program
- Add `npx shadcn@latest add accordion` if not already installed
- Responsive layout, accessible headings, keyboard-navigable accordions

**Header navigation update (`src/components/layout/Header.tsx`):**

Update the site header to include navigation links:
- "Directory" link to `/directory` (organization search)
- "Businesses" link to `/directory/businesses`
- "Documents" link to `/resources/documents`
- Maintain existing auth UI (login/signup or user email)
- Responsive: collapse to hamburger menu on mobile if needed, or keep inline if 3-4 links fit
- Active link styling (highlight current page)
- All links accessible with proper aria-current="page" on active link
  </action>
  <verify>
Run `npm run build` to verify all pages compile. Start dev server:
1. Navigate to `/directory/businesses` -- business search loads
2. Search "construction" -- results appear with construction-related businesses
3. Filter by state -- results narrow
4. Click a business -- detail page loads with full information
5. Navigate to `/resources/documents` -- checklists page loads with all 8 programs
6. Expand a program accordion -- documents list appears with required/recommended labels
7. Header shows Directory, Businesses, Documents links
8. Click each header link -- navigates correctly
  </verify>
  <done>
Business search page works with FTS, state, and type filters. Business detail page shows full information. Documentation checklists page lists 8 programs with required documents. Header navigation includes all directory links.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete directory experience end-to-end</name>
  <files>none (verification only)</files>
  <action>
Human verification checkpoint. What was built:
Complete resource directory with organization search (85K+), business search (5.5K+), detail pages, freshness badges, documentation checklists, and site navigation.

How to verify:
1. Start dev server: `npm run dev`
2. Visit http://localhost:3000 -- header should show Directory, Businesses, Documents links
3. Click "Directory" -- organization search page loads
4. Type "mental health" in search -- results appear with relevant organizations
5. Select state "KY" -- results narrow to Kentucky
6. Verify freshness badges show colored indicators (green/yellow/red)
7. Click an organization name -- detail page loads with contact, services, classification
8. Click "Back to directory" -- returns to search with filters preserved
9. Click "Businesses" in header -- business search page loads
10. Search for a business name or industry term -- results appear
11. Click a business -- detail page shows contact and industry info
12. Click "Documents" in header -- documentation checklists page loads
13. Expand "VA Disability Compensation" -- document list appears
14. Verify all 8 programs have checklists
15. Test keyboard navigation through the entire flow (Tab through search, filters, results, pagination)
16. Resize browser to mobile width -- verify responsive layout
  </action>
  <verify>User types "approved" or describes issues to fix</verify>
  <done>User confirms the complete directory experience works correctly end-to-end</done>
</task>

</tasks>

<verification>
After all tasks complete and checkpoint approved:
1. Organization search works with FTS, filters, pagination across 85K+ records
2. Business search works with FTS, filters, pagination across 5.5K+ records
3. Detail pages show complete information with freshness indicators
4. Documentation checklists cover 8 core programs with required documents
5. Header navigation provides access to all directory pages
6. All pages are responsive and keyboard-accessible
7. `npm run build` succeeds with no errors
</verification>

<success_criteria>
- All 7 Phase 2 success criteria are met:
  1. Full-text search across 85K+ organizations (DIR-01)
  2. Filters by benefit type, state, veteran-focused, service category (DIR-02)
  3. Organization detail with contact, services, freshness (DIR-03)
  4. Business search by industry and location (DIR-04)
  5. Freshness display green/yellow/red (DIR-05)
  6. Documentation checklists per program (DIR-06)
  7. ETL imports both data sources (DATA-01, DATA-02, DATA-03, DATA-04) -- verified in Plans 01-02
- Site navigation updated with directory links
- Human verification confirms end-to-end experience
</success_criteria>

<output>
After completion, create `.planning/phases/02-resource-directory-data-pipeline/02-04-SUMMARY.md`
</output>
