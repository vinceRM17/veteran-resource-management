---
phase: 06-self-service-tools
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/app/tools/transition/page.tsx
  - src/app/tools/transition/[milestone]/page.tsx
  - src/lib/db/checklist-actions.ts
  - src/components/tools/ChecklistItemRow.tsx
  - src/components/layout/Header.tsx
autonomous: true

must_haves:
  truths:
    - "User can access transition planning checklists for separating service members (180 days, 90 days, 30 days milestones)"
    - "User can track completion of checklist items if logged in"
    - "Unauthenticated users can view checklists but see a prompt to log in for tracking"
    - "Self-service tools section is discoverable from the main navigation"
  artifacts:
    - path: "src/app/tools/transition/page.tsx"
      provides: "Transition checklist overview page with milestone cards"
      min_lines: 40
    - path: "src/app/tools/transition/[milestone]/page.tsx"
      provides: "Milestone detail page with checklist items and progress tracking"
      min_lines: 60
    - path: "src/lib/db/checklist-actions.ts"
      provides: "Server actions for creating and toggling transition checklist action items"
      exports: ["saveChecklistProgress", "getChecklistProgress"]
    - path: "src/components/tools/ChecklistItemRow.tsx"
      provides: "Client component for individual checklist item with checkbox toggle"
      min_lines: 30
    - path: "src/components/layout/Header.tsx"
      provides: "Updated header with Tools navigation link"
      contains: "href.*tools"
  key_links:
    - from: "src/app/tools/transition/[milestone]/page.tsx"
      to: "src/content/transition-checklists.ts"
      via: "import and filter by milestone slug"
      pattern: "transitionChecklists\\.find"
    - from: "src/app/tools/transition/[milestone]/page.tsx"
      to: "src/lib/db/checklist-actions.ts"
      via: "server action for progress tracking"
      pattern: "getChecklistProgress"
    - from: "src/components/tools/ChecklistItemRow.tsx"
      to: "src/lib/db/checklist-actions.ts"
      via: "server action call on checkbox toggle"
      pattern: "saveChecklistProgress"
    - from: "src/components/layout/Header.tsx"
      to: "/tools"
      via: "navigation link"
      pattern: "href.*tools"
---

<objective>
Create the transition checklist pages with progress tracking for logged-in users, and add Tools to the main navigation.

Purpose: Separating service members need clear milestone-based checklists to prepare for civilian life. Logged-in users should be able to track their progress through these checklists, persisted via the existing action_items system. The Tools section needs to be discoverable from the header navigation.

Output: Transition checklist overview page, milestone detail pages with trackable items, server actions for progress persistence, and updated header navigation.
</objective>

<execution_context>
@/Users/vincecain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vincecain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-self-service-tools/06-01-SUMMARY.md
@src/content/transition-checklists.ts
@src/lib/db/action-item-actions.ts
@src/lib/db/dashboard-types.ts
@src/components/layout/Header.tsx
@src/components/dashboard/ActionItemsList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create transition checklist pages with progress tracking</name>
  <files>src/app/tools/transition/page.tsx, src/app/tools/transition/[milestone]/page.tsx, src/lib/db/checklist-actions.ts, src/components/tools/ChecklistItemRow.tsx</files>
  <action>
Create the transition checklist browsing and tracking experience using the existing action_items table for persistence.

**File 1: src/lib/db/checklist-actions.ts** (Server Actions)

"use server" module with two exported functions:

1. `getChecklistProgress(milestoneSlug: string)`: Returns `Record<string, boolean>` mapping checklist item IDs to completion status.
   - Get user via createClient + auth.getUser()
   - If no user, return empty object (guest mode, no tracking)
   - Query action_items where program_name = `transition-${milestoneSlug}` and user_id = user.id
   - Return object mapping title (used as key) to is_completed boolean
   - Use the title field to match checklist items (since these are static content items, not screening-derived)

2. `saveChecklistProgress(milestoneSlug: string, itemId: string, itemTitle: string, completed: boolean)`: Toggles a checklist item.
   - Get user via createClient + auth.getUser()
   - If no user, return { success: false, error: "Log in to track your progress." }
   - Check if action_item exists: query where program_name = `transition-${milestoneSlug}` AND title = itemTitle AND user_id = user.id
   - If exists: update is_completed and completed_at (null if unchecking)
   - If not exists AND completed=true: insert new action_item with user_id, program_name = `transition-${milestoneSlug}`, program_id = milestoneSlug, title = itemTitle, description = null, is_completed = true, completed_at = now(), sort_order = 0
   - Return { success: true, isCompleted: completed }

This reuses the existing action_items table. Transition checklist items are identified by program_name = "transition-{milestone-slug}" to distinguish them from screening-derived action items.

**File 2: src/components/tools/ChecklistItemRow.tsx** (Client Component)

"use client" component accepting props:
```typescript
interface ChecklistItemRowProps {
  milestoneSlug: string;
  item: { id: string; title: string; description: string; resources: { label: string; url: string }[] };
  initialChecked: boolean;
  isAuthenticated: boolean;
}
```

Implementation:
- If isAuthenticated: render a Checkbox (shadcn/ui) with optimistic UI via useTransition (follow pattern from ActionItemsList.tsx)
- On toggle: call saveChecklistProgress server action, revert on failure
- If not authenticated: render a disabled checkbox with a small text note "Log in to track progress" on the first unchecked item only (pass a showLoginHint prop)
- Below checkbox+title: show description in muted text, and resource links as a list of anchor tags (text-blue-600, underline, target="_blank" rel="noopener noreferrer")
- Use revalidatePath("/tools/transition/[milestone]") is NOT needed since we use optimistic UI

**File 3: src/app/tools/transition/page.tsx** (Transition Overview)

Server Component with:
- Metadata: title "Transition Planning Checklists | Veteran Resource Management"
- Import transitionChecklists from content file
- Page heading "Transition Planning Checklists" with intro: "Leaving the military? Use these checklists to stay on track. Each milestone covers what you need to do before your separation date."
- Grid of milestone cards (gap-6, max 3 columns on lg) — one Card per TransitionMilestone
- Each card shows: milestone name, timeframe badge (e.g., "6 months out"), description, item count, and Link to /tools/transition/{milestone.slug}
- Use lucide-react Calendar icon
- Back link to /tools at top

**File 4: src/app/tools/transition/[milestone]/page.tsx** (Milestone Detail)

Server Component with dynamic route:
- Import transitionChecklists from content file
- Import getChecklistProgress from checklist-actions
- Find milestone by slug from params, return notFound() if not found
- generateStaticParams() for all milestone slugs
- generateMetadata() with milestone-specific title
- Fetch progress via getChecklistProgress(milestone.slug) — returns empty for guests
- Get auth state via createClient + getUser to determine isAuthenticated
- Calculate progress: completed count / total items, show progress bar if authenticated and any items completed
- Page heading with milestone name and timeframe badge
- Each ChecklistItem rendered using ChecklistItemRow component, passing initialChecked from progress lookup and isAuthenticated flag
- Show "Log in to save your progress" banner at top if not authenticated (use a subtle bg-blue-50 info box with Link to /login?next=/tools/transition/{slug})
- Back link to /tools/transition at top
- Bottom note with crisis line reference
  </action>
  <verify>
```bash
npx tsc --noEmit src/lib/db/checklist-actions.ts src/components/tools/ChecklistItemRow.tsx src/app/tools/transition/page.tsx src/app/tools/transition/\\[milestone\\]/page.tsx
```
Visit /tools/transition — shows 3 milestone cards. Visit /tools/transition/180-days — shows checklist items with checkboxes. Logged-in user can check items and see progress bar update. Guest sees login prompt.
  </verify>
  <done>
/tools/transition shows 3 milestone cards (180, 90, 30 days). Each milestone detail page shows checklist items with checkbox tracking for authenticated users, login prompt for guests, resource links, and progress bar. Checklist progress persists in action_items table with program_name "transition-{slug}" prefix.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Tools link to main navigation header</name>
  <files>src/components/layout/Header.tsx</files>
  <action>
Update the Header component (src/components/layout/Header.tsx) to include a "Tools" navigation link.

Add a new `<li>` in the nav `<ul>` between "Screening" and the auth section (before the `{user ? (` conditional). The link should:
- Point to `/tools`
- Use the same styling as other nav links: `hover:underline focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 rounded`
- Text: "Tools"

The nav order should be: Home, Directory, Businesses, Documents, Screening, Tools, [auth links].

Do NOT change any other part of the Header component.
  </action>
  <verify>
```bash
npx tsc --noEmit src/components/layout/Header.tsx
```
Visit any page — header shows "Tools" link between "Screening" and auth section. Clicking "Tools" navigates to /tools.
  </verify>
  <done>
Header navigation includes "Tools" link pointing to /tools, consistent with existing nav link styling, positioned after "Screening" in the navigation order.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors in all new/modified files
2. /tools/transition renders 3 milestone cards (180 days, 90 days, 30 days)
3. /tools/transition/180-days renders checklist items with checkboxes and resource links
4. Authenticated user can check/uncheck items with optimistic UI feedback
5. Guest user sees login prompt and disabled checkboxes
6. Checked items persist across page refresh for authenticated users
7. Header shows "Tools" link navigating to /tools
8. Progress bar shows on milestone page when authenticated and items checked
9. /tools/transition/nonexistent returns 404
</verification>

<success_criteria>
- 3 transition milestone pages with trackable checklist items
- Checklist progress persists via action_items table for logged-in users
- Unauthenticated users can browse but see login prompt for tracking
- Progress bar shows completion status on milestone detail pages
- Header navigation updated with Tools link
- Complete self-service tools section accessible: /tools, /tools/exercises/*, /tools/transition/*
</success_criteria>

<output>
After completion, create `.planning/phases/06-self-service-tools/06-02-SUMMARY.md`
</output>
